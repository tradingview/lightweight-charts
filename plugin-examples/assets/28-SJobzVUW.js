import{K as p,h as v,q as P,n as b}from"./lightweight-charts.production-BQu0Tfey.js";import{g as m}from"./sample-data-x_8-FZm1.js";import{P as C}from"./plugin-base-8m8IYSME.js";import{a as f,p as w}from"./positions-t2UKkghX.js";const a=21,g="M7.5,7.5 m -7,0 a 7,7 0 1,0 14,0 a 7,7 0 1,0 -14,0 M4 7.5H11 M7.5 4V11",L=new Path2D(g),x=15;class S{_y=0;_data;constructor(t){this._data=t}update(t,e){if(this._data=t,!this._data.price){this._y=-1e4;return}this._y=e.priceToCoordinate(this._data.price)??-1e4}}class M{_data;constructor(t){this._data=t}draw(t){this._data.visible&&t.useBitmapCoordinateSpace(e=>{const i=e.context,n=a,_=n+1,s=f(this._data.rightX-_,this._data.rightX-1,e.horizontalPixelRatio),r=w(this._data.y,e.verticalPixelRatio,n);i.fillStyle=this._data.color;const h=[5,0,0,5].map(u=>u*e.horizontalPixelRatio);i.beginPath(),i.roundRect(s.position,r.position,s.length,r.length,h),i.fill(),this._data.hovered&&(i.fillStyle=this._data.hoverColor,i.beginPath(),i.roundRect(s.position,r.position,s.length,r.length,h),i.fill()),i.translate(s.position+3*e.horizontalPixelRatio,r.position+3*e.verticalPixelRatio),i.scale(e.horizontalPixelRatio,e.verticalPixelRatio);const l=15/x;i.scale(l,l),i.strokeStyle=this._data.textColor,i.lineWidth=1,i.stroke(L)})}}class y extends S{renderer(){const t=this._data.crosshairColor;return new M({visible:this._data.visible,y:this._y,color:t,textColor:this._data.crosshairLabelColor,rightX:this._data.timeScaleWidth,hoverColor:this._data.hoverColor,hovered:this._data.hovered??!1})}zOrder(){return"top"}}class B extends C{_paneViews;_data={visible:!1,hovered:!1,timeScaleWidth:0,crosshairLabelColor:"#000000",crosshairColor:"#ffffff",lineColor:"#000000",hoverColor:"#777777"};_source;constructor(t){super(),this._paneViews=[new y(this._data)],this._source=t}updateAllViews(){this._paneViews.forEach(t=>t.update(this._data,this.series))}priceAxisViews(){return[]}paneViews(){return this._paneViews}showAddLabel(t,e){const i=this.chart.options().crosshair.horzLine.labelBackgroundColor;this._data={visible:!0,price:t,hovered:e,timeScaleWidth:this.chart.timeScale().width(),crosshairColor:i,crosshairLabelColor:"#FFFFFF",lineColor:this._source.currentLineColor(),hoverColor:this._source.currentHoverColor()},this.updateAllViews(),this.requestUpdate()}hideAddLabel(){this._data.visible=!1,this.updateAllViews(),this.requestUpdate()}}const R={color:"#000000",hoverColor:"#777777",limitToOne:!0};class k{_chart;_series;_options;_labelButtonPrimitive;constructor(t,e,i){this._chart=t,this._series=e,this._options={...R,...i},this._chart.subscribeClick(this._clickHandler),this._chart.subscribeCrosshairMove(this._moveHandler),this._labelButtonPrimitive=new B(this),e.attachPrimitive(this._labelButtonPrimitive),this._setCrosshairMode()}currentLineColor(){return this._options.color}currentHoverColor(){return this._options.hoverColor}_setCrosshairMode(){if(!this._chart)throw new Error("Unable to change crosshair mode because the chart instance is undefined");this._chart.applyOptions({crosshair:{mode:p.Normal}})}_clickHandler=t=>this._onClick(t);_moveHandler=t=>this._onMouseMove(t);remove(){this._chart&&(this._chart.unsubscribeClick(this._clickHandler),this._chart.unsubscribeCrosshairMove(this._moveHandler)),this._series&&this._labelButtonPrimitive&&this._series.detachPrimitive(this._labelButtonPrimitive),this._chart=void 0,this._series=void 0}_onClick(t){const e=this._getMousePrice(t),i=this._distanceFromRightScale(t);e===null||i===null||i>a||!this._series||this._series.createPriceLine({price:e,color:this._options.color,lineStyle:v.Dashed})}_onMouseMove(t){const e=this._getMousePrice(t),i=this._distanceFromRightScale(t);if(e===null||i===null||i>a*2){this._labelButtonPrimitive.hideAddLabel();return}this._labelButtonPrimitive.showAddLabel(e,i<a)}_getMousePrice(t){return!t.point||!this._series?null:this._series.coordinateToPrice(t.point.y)}_distanceFromRightScale(t){if(!t.point||!this._chart)return null;const e=this._chart.timeScale().width();return Math.abs(e-t.point.x)}}const c=window.chart=P("chart",{autoSize:!0}),d=c.addSeries(b),H=m();d.setData(H);new k(c,d,{color:"hotpink"});
