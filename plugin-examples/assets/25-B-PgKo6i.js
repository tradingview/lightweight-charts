import{K as v,q as g,S as x}from"./lightweight-charts.production-DvNXqfdG.js";import{g as E}from"./sample-data-x_8-FZm1.js";import{f as y,c as w}from"./time-FQjJLuZA.js";import{p as C}from"./positions-t2UKkghX.js";const P={title:"",followMode:"tracking",horizontalDeadzoneWidth:45,verticalDeadzoneHeight:100,verticalSpacing:20,topOffset:20};class M{_chart;_element;_titleElement;_priceElement;_dateElement;_timeElement;_options;_lastTooltipWidth=null;constructor(t,e){this._options={...P,...e},this._chart=t;const i=document.createElement("div");p(i,{display:"flex","flex-direction":"column","align-items":"center",position:"absolute",transform:"translate(calc(0px - 50%), 0px)",opacity:"0",left:"0%",top:"0","z-index":"100","background-color":"white","border-radius":"4px",padding:"5px 10px","font-family":"-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif","font-size":"12px","font-weight":"400","box-shadow":"0px 2px 4px rgba(0, 0, 0, 0.2)","line-height":"16px","pointer-events":"none",color:"#131722"});const s=document.createElement("div");p(s,{"font-size":"16px","line-height":"24px","font-weight":"590"}),a(s,this._options.title),i.appendChild(s);const n=document.createElement("div");p(n,{"font-size":"14px","line-height":"18px","font-weight":"590"}),a(n,""),i.appendChild(n);const c=document.createElement("div");p(c,{color:"#787B86"}),a(c,""),i.appendChild(c);const r=document.createElement("div");p(r,{color:"#787B86"}),a(r,""),i.appendChild(r),this._element=i,this._titleElement=s,this._priceElement=n,this._dateElement=c,this._timeElement=r;const _=this._chart.chartElement();_.appendChild(this._element);const m=_.parentElement;if(!m){console.error("Chart Element is not attached to the page.");return}const h=getComputedStyle(m).position;h!=="relative"&&h!=="absolute"&&console.error("Chart Element position is expected be `relative` or `absolute`.")}destroy(){this._chart&&this._element&&this._chart.chartElement().removeChild(this._element)}applyOptions(t){this._options={...this._options,...t}}options(){return this._options}updateTooltipContent(t){if(!this._element)return;const e=this._element.getBoundingClientRect();this._lastTooltipWidth=e.width,t.title!==void 0&&this._titleElement&&a(this._titleElement,t.title),a(this._priceElement,t.price),a(this._dateElement,t.date),a(this._timeElement,t.time)}updatePosition(t){if(!this._chart||!this._element||(this._element.style.opacity=t.visible?"1":"0",!t.visible))return;const e=this._calculateXPosition(t,this._chart),i=this._calculateYPosition(t);this._element.style.transform=`translate(${e}, ${i})`}_calculateXPosition(t,e){const i=t.paneX+e.priceScale("left").width(),s=this._lastTooltipWidth?Math.ceil(this._lastTooltipWidth/2):this._options.horizontalDeadzoneWidth;return`calc(${Math.min(Math.max(s,i),e.timeScale().width()-s)}px - 50%)`}_calculateYPosition(t){if(this._options.followMode=="top")return`${this._options.topOffset}px`;const e=t.paneY,i=e<=this._options.verticalSpacing+this._options.verticalDeadzoneHeight;return`calc(${e+(i?1:-1)*this._options.verticalSpacing}px${i?"":" - 100%"})`}}function a(o,t){!o||t===o.innerText||(o.innerText=t,o.style.display=t?"block":"none")}function p(o,t){for(const[e,i]of Object.entries(t))o.style.setProperty(e,i)}class T{_data;constructor(t){this._data=t}draw(t){this._data.visible&&t.useBitmapCoordinateSpace(e=>{const i=e.context,s=C(this._data.x,e.horizontalPixelRatio,1);i.fillStyle=this._data.color,i.fillRect(s.position,this._data.topMargin*e.verticalPixelRatio,s.length,e.bitmapSize.height)})}}class S{_data;constructor(t){this._data=t}update(t){this._data=t}renderer(){return new T(this._data)}zOrder(){return"bottom"}}const z={lineColor:"rgba(0, 0, 0, 0.2)",priceExtractor:o=>o.value!==void 0?o.value.toFixed(2):o.close!==void 0?o.close.toFixed(2):""};class L{_options;_tooltip=void 0;_paneViews;_data={x:0,visible:!1,color:"rgba(0, 0, 0, 0.2)",topMargin:0};_attachedParams;constructor(t){this._options={...z,...t},this._paneViews=[new S(this._data)]}attached(t){this._attachedParams=t,this._setCrosshairMode(),t.chart.subscribeCrosshairMove(this._moveHandler),this._createTooltipElement()}detached(){const t=this.chart();t&&t.unsubscribeCrosshairMove(this._moveHandler)}paneViews(){return this._paneViews}updateAllViews(){this._paneViews.forEach(t=>t.update(this._data))}setData(t){this._data=t,this.updateAllViews(),this._attachedParams?.requestUpdate()}currentColor(){return this._options.lineColor}chart(){return this._attachedParams?.chart}series(){return this._attachedParams?.series}applyOptions(t){this._options={...this._options,...t},this._tooltip&&this._tooltip.applyOptions({...this._options.tooltip})}_setCrosshairMode(){const t=this.chart();if(!t)throw new Error("Unable to change crosshair mode because the chart instance is undefined");t.applyOptions({crosshair:{mode:v.Magnet,vertLine:{visible:!1,labelVisible:!1},horzLine:{visible:!1,labelVisible:!1}}})}_moveHandler=t=>this._onMouseMove(t);_hideTooltip(){this._tooltip&&(this._tooltip.updateTooltipContent({title:"",price:"",date:"",time:""}),this._tooltip.updatePosition({paneX:0,paneY:0,visible:!1}))}_hideCrosshair(){this._hideTooltip(),this.setData({x:0,visible:!1,color:this.currentColor(),topMargin:0})}_onMouseMove(t){const e=this.chart(),i=this.series(),s=t.logical;if(!s||!e||!i){this._hideCrosshair();return}const n=t.seriesData.get(i);if(!n){this._hideCrosshair();return}const c=this._options.priceExtractor(n),r=e.timeScale().logicalToCoordinate(s),[_,m]=y(t.time?w(t.time):void 0);if(this._tooltip){const h=this._tooltip.options(),b=h.followMode=="top"?h.topOffset+10:0;this.setData({x:r??0,visible:r!==null,color:this.currentColor(),topMargin:b}),this._tooltip.updateTooltipContent({price:c,date:_,time:m}),this._tooltip.updatePosition({paneX:t.point?.x??0,paneY:t.point?.y??0,visible:!0})}}_createTooltipElement(){const t=this.chart();if(!t)throw new Error("Unable to create Tooltip element. Chart not attached");this._tooltip=new M(t,{...this._options.tooltip})}}const O=window.chart=g("chart",{autoSize:!0,grid:{vertLines:{visible:!1},horzLines:{visible:!1}},timeScale:{borderVisible:!1},rightPriceScale:{borderVisible:!1}}),f=O.addSeries(x,{lineColor:"rgb(4,153,129)",topColor:"rgba(4,153,129, 0.4)",bottomColor:"rgba(4,153,129, 0)",priceLineVisible:!1});f.setData(E());const u=new L({lineColor:"rgba(0, 0, 0, 0.2)",tooltip:{followMode:"top"}});f.attachPrimitive(u);const l=document.querySelector("#tracking-button");l&&l.classList.add("grey");const d=document.querySelector("#top-button");l&&l.addEventListener("click",function(){l.classList.remove("grey"),d&&d.classList.add("grey"),u.applyOptions({tooltip:{followMode:"tracking"}})});d&&d.addEventListener("click",function(){d.classList.remove("grey"),l&&l.classList.add("grey"),u.applyOptions({tooltip:{followMode:"top"}})});
