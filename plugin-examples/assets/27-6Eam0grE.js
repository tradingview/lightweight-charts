import{q as p,h as V,S as D,N as F}from"./lightweight-charts.production-Co-rHmTL.js";import{g as B}from"./sample-data-x_8-FZm1.js";import{D as C}from"./delegate-DWQRnY1D.js";import{p as v}from"./positions-t2UKkghX.js";const f=21,R=21,k=17,g=4,I=2,x=13,y=13,E=50,H=5.81,_=26,L=20,P=9,W=[new Path2D("M5.34004 1.12254C4.7902 0.438104 3.94626 0 3 0C1.34315 0 0 1.34315 0 3C0 3.94626 0.438104 4.7902 1.12254 5.34004C1.04226 5.714 1 6.10206 1 6.5C1 9.36902 3.19675 11.725 6 11.9776V10.9725C3.75002 10.7238 2 8.81628 2 6.5C2 4.01472 4.01472 2 6.5 2C8.81628 2 10.7238 3.75002 10.9725 6H11.9776C11.9574 5.77589 11.9237 5.55565 11.8775 5.34011C12.562 4.79026 13.0001 3.9463 13.0001 3C13.0001 1.34315 11.6569 0 10.0001 0C9.05382 0 8.20988 0.438111 7.66004 1.12256C7.28606 1.04227 6.89797 1 6.5 1C6.10206 1 5.714 1.04226 5.34004 1.12254ZM4.28255 1.46531C3.93534 1.17484 3.48809 1 3 1C1.89543 1 1 1.89543 1 3C1 3.48809 1.17484 3.93534 1.46531 4.28255C2.0188 3.02768 3.02768 2.0188 4.28255 1.46531ZM8.71751 1.46534C9.97237 2.01885 10.9812 3.02774 11.5347 4.28262C11.8252 3.93541 12.0001 3.48812 12.0001 3C12.0001 1.89543 11.1047 1 10.0001 1C9.51199 1 9.06472 1.17485 8.71751 1.46534Z"),new Path2D("M7 7V4H8V8H5V7H7Z"),new Path2D("M10 8V10H8V11H10V13H11V11H13V10H11V8H10Z")],T=[new Path2D("M5.11068 1.65894C3.38969 2.08227 1.98731 3.31569 1.33103 4.93171C0.938579 4.49019 0.700195 3.90868 0.700195 3.27148C0.700195 1.89077 1.81948 0.771484 3.2002 0.771484C3.9664 0.771484 4.65209 1.11617 5.11068 1.65894Z"),new Path2D("M12.5 3.37148C12.5 4.12192 12.1694 4.79514 11.6458 5.25338C11.0902 3.59304 9.76409 2.2857 8.09208 1.7559C8.55066 1.21488 9.23523 0.871484 10 0.871484C11.3807 0.871484 12.5 1.99077 12.5 3.37148Z"),new Path2D("M6.42896 11.4999C8.91424 11.4999 10.929 9.48522 10.929 6.99994C10.929 4.51466 8.91424 2.49994 6.42896 2.49994C3.94367 2.49994 1.92896 4.51466 1.92896 6.99994C1.92896 9.48522 3.94367 11.4999 6.42896 11.4999ZM6.00024 3.99994V6.99994H4.00024V7.99994H7.00024V3.99994H6.00024Z"),new Path2D("M4.08902 0.934101C4.4888 1.08621 4.83946 1.33793 5.11068 1.65894C5.06565 1.67001 5.02084 1.68164 4.97625 1.69382C4.65623 1.78123 4.34783 1.89682 4.0539 2.03776C3.16224 2.4653 2.40369 3.12609 1.8573 3.94108C1.64985 4.2505 1.47298 4.58216 1.33103 4.93171C1.05414 4.6202 0.853937 4.23899 0.760047 3.81771C0.720863 3.6419 0.700195 3.45911 0.700195 3.27148C0.700195 1.89077 1.81948 0.771484 3.2002 0.771484C3.51324 0.771484 3.81285 0.829023 4.08902 0.934101ZM12.3317 4.27515C12.4404 3.99488 12.5 3.69015 12.5 3.37148C12.5 1.99077 11.3807 0.871484 10 0.871484C9.66727 0.871484 9.34974 0.936485 9.05938 1.05448C8.68236 1.20769 8.35115 1.45027 8.09208 1.7559C8.43923 1.8659 8.77146 2.00942 9.08499 2.18265C9.96762 2.67034 10.702 3.39356 11.2032 4.26753C11.3815 4.57835 11.5303 4.90824 11.6458 5.25338C11.947 4.98973 12.1844 4.65488 12.3317 4.27515ZM9.18112 3.43939C8.42029 2.85044 7.46556 2.49994 6.42896 2.49994C3.94367 2.49994 1.92896 4.51466 1.92896 6.99994C1.92896 9.48522 3.94367 11.4999 6.42896 11.4999C8.91424 11.4999 10.929 9.48522 10.929 6.99994C10.929 5.55126 10.2444 4.26246 9.18112 3.43939ZM6.00024 3.99994H7.00024V7.99994H4.00024V6.99994H6.00024V3.99994Z")],Z=10,N=new Path2D("M9.35359 1.35359C9.11789 1.11789 8.88219 0.882187 8.64648 0.646484L5.00004 4.29293L1.35359 0.646484C1.11791 0.882212 0.882212 1.11791 0.646484 1.35359L4.29293 5.00004L0.646484 8.64648C0.882336 8.88204 1.11804 9.11774 1.35359 9.35359L5.00004 5.70714L8.64648 9.35359C8.88217 9.11788 9.11788 8.88217 9.35359 8.64649L5.70714 5.00004L9.35359 1.35359Z");class ${_chart=void 0;_series=void 0;_unSubscribers=[];_clicked=new C;_mouseMoved=new C;attached(e,t){this._chart=e,this._series=t;const i=this._chart.chartElement();this._addMouseEventListener(i,"mouseleave",this._mouseLeave),this._addMouseEventListener(i,"mousemove",this._mouseMove),this._addMouseEventListener(i,"click",this._mouseClick)}detached(){this._series=void 0,this._clicked.destroy(),this._mouseMoved.destroy(),this._unSubscribers.forEach(e=>{e()}),this._unSubscribers=[]}clicked(){return this._clicked}mouseMoved(){return this._mouseMoved}_addMouseEventListener(e,t,i){const r=i.bind(this);e.addEventListener(t,r);const s=()=>{e.removeEventListener(t,r)};this._unSubscribers.push(s)}_mouseLeave(){this._mouseMoved.fire(null)}_mouseMove(e){this._mouseMoved.fire(this._determineMousePosition(e))}_mouseClick(e){this._clicked.fire(this._determineMousePosition(e))}_determineMousePosition(e){if(!this._chart||!this._series)return null;const t=this._chart.chartElement(),i=t.getBoundingClientRect(),r=this._series.priceScale().width(),s=this._chart.timeScale().height(),a=e.clientX-i.x,o=e.clientY-i.y,h=o>t.clientHeight-s,l=t.clientWidth-r-a,c=l<0;return{x:a,y:o,xPositionRelativeToPriceScale:l,overPriceScale:c,overTimeScale:h}}}class M{_data=null;update(e){this._data=e}}class X extends M{draw(e){e.useBitmapCoordinateSpace(t=>{if(!this._data)return;this._drawAlertLines(t),this._drawAlertIcons(t),this._data.alerts.some(r=>r.showHover&&r.hoverRemove)||(this._drawCrosshairLine(t),this._drawCrosshairLabelButton(t)),this._drawAlertLabel(t)})}_drawHorizontalLine(e,t){const i=e.context;try{const r=v(t.y,e.verticalPixelRatio,t.lineWidth),s=r.position+r.length/2;i.save(),i.beginPath(),i.lineWidth=t.lineWidth,i.strokeStyle=t.color;const a=4*e.horizontalPixelRatio;i.setLineDash([a,a]),i.moveTo(0,s),i.lineTo((t.width-f)*e.horizontalPixelRatio,s),i.stroke()}finally{i.restore()}}_drawAlertLines(e){if(!this._data?.alerts)return;const t=this._data.color;this._data.alerts.forEach(i=>{this._drawHorizontalLine(e,{width:e.mediaSize.width,lineWidth:1,color:t,y:i.y})})}_drawAlertIcons(e){if(!this._data?.alerts)return;const t=this._data.color,i=this._data.alertIcon;this._data.alerts.forEach(r=>{this._drawLabel(e,{width:e.mediaSize.width,labelHeight:k,y:r.y,roundedCorners:2,icon:i,iconScaling:y/x,padding:{left:g,top:I},color:t})})}_calculateLabelWidth(e){return P*2+_+e*H}_drawAlertLabel(e){if(!this._data?.alerts)return;const t=e.context,i=this._data.alerts.find(o=>o.showHover);if(!i||!i.showHover)return;const r=this._calculateLabelWidth(i.text.length),s=v(e.mediaSize.width/2,e.horizontalPixelRatio,r),a=v(i.y,e.verticalPixelRatio,L);t.save();try{const o=4*e.horizontalPixelRatio;t.beginPath(),t.roundRect(s.position,a.position,s.length,a.length,o),t.fillStyle="#FFFFFF",t.fill();const h=s.position+s.length-_*e.horizontalPixelRatio;i.hoverRemove&&(t.beginPath(),t.roundRect(h,a.position,_*e.horizontalPixelRatio,a.length,[0,o,o,0]),t.fillStyle="#F0F3FA",t.fill()),t.beginPath();const l=v(h/e.horizontalPixelRatio,e.horizontalPixelRatio,1);t.fillStyle="#F1F3FB",t.fillRect(l.position,a.position,l.length,a.length),t.beginPath(),t.roundRect(s.position,a.position,s.length,a.length,o),t.strokeStyle="#131722",t.lineWidth=1*e.horizontalPixelRatio,t.stroke(),t.beginPath(),t.fillStyle="#131722",t.textBaseline="middle",t.font=`${Math.round(12*e.verticalPixelRatio)}px sans-serif`,t.fillText(i.text,s.position+P*e.horizontalPixelRatio,i.y*e.verticalPixelRatio),t.beginPath();const c=9;t.translate(h+e.horizontalPixelRatio*(_-c)/2,(i.y-5)*e.verticalPixelRatio);const d=c/Z*e.horizontalPixelRatio;t.scale(d,d),t.fillStyle="#131722",t.fill(N,"evenodd")}finally{t.restore()}}_drawCrosshairLine(e){this._data?.crosshair&&this._drawHorizontalLine(e,{width:e.mediaSize.width,lineWidth:1,color:this._data.color,y:this._data.crosshair.y})}_drawCrosshairLabelButton(e){!this._data?.button||!this._data?.crosshair||this._drawLabel(e,{width:e.mediaSize.width,labelHeight:R,y:this._data.crosshair.y,roundedCorners:[2,0,0,2],icon:this._data.button.crosshairLabelIcon,iconScaling:y/x,padding:{left:g,top:g},color:this._data.button.hovering?this._data.button.hoverColor:this._data.color})}_drawLabel(e,t){const i=e.context;try{i.save(),i.beginPath();const r=v(t.y,e.verticalPixelRatio,t.labelHeight),s=(t.width-(f+1))*e.horizontalPixelRatio;i.roundRect(s,r.position,f*e.horizontalPixelRatio,r.length,U(t.roundedCorners,e.horizontalPixelRatio)),i.fillStyle=t.color,i.fill(),i.beginPath(),i.translate(s+t.padding.left*e.horizontalPixelRatio,r.position+t.padding.top*e.verticalPixelRatio),i.scale(t.iconScaling*e.horizontalPixelRatio,t.iconScaling*e.verticalPixelRatio),i.fillStyle="#FFFFFF",t.icon.forEach(a=>{i.beginPath(),i.fill(a,"evenodd")})}finally{i.restore()}}}function U(n,e){return typeof n=="number"?n*e:n.map(t=>t*e)}class Y extends M{draw(e){e.useBitmapCoordinateSpace(t=>{this._data&&this._drawCrosshairLabel(t)})}_drawCrosshairLabel(e){if(!this._data?.crosshair)return;const t=e.context;try{const r=e.bitmapSize.width-8*e.horizontalPixelRatio;t.save(),t.beginPath(),t.fillStyle=this._data.color;const s=v(this._data.crosshair.y,e.verticalPixelRatio,R),a=2*e.horizontalPixelRatio;t.roundRect(0,s.position,r,s.length,[0,a,a,0]),t.fill(),t.beginPath(),t.fillStyle="#FFFFFF",t.textBaseline="middle",t.textAlign="right",t.font=`${Math.round(12*e.verticalPixelRatio)}px sans-serif`;const o=t.measureText(this._data.crosshair.text);t.fillText(this._data.crosshair.text,o.width+10*e.horizontalPixelRatio,this._data.crosshair.y*e.verticalPixelRatio)}finally{t.restore()}}}class S{_renderer;constructor(e){this._renderer=e?new Y:new X}zOrder(){return"top"}renderer(){return this._renderer}update(e){this._renderer.update(e)}}class O{_alertAdded=new C;_alertRemoved=new C;_alertChanged=new C;_alertsChanged=new C;_alerts;constructor(){this._alerts=new Map,this._alertsChanged.subscribe(()=>{this._updateAlertsArray()},this)}destroy(){this._alertsChanged.unsubscribeAll(this)}alertAdded(){return this._alertAdded}alertRemoved(){return this._alertRemoved}alertChanged(){return this._alertChanged}alertsChanged(){return this._alertsChanged}addAlert(e){const t=this._getNewId(),i={price:e,id:t};return this._alerts.set(t,i),this._alertAdded.fire(i),this._alertsChanged.fire(),t}removeAlert(e){this._alerts.has(e)&&(this._alerts.delete(e),this._alertRemoved.fire(e),this._alertsChanged.fire())}alerts(){return this._alertsArray}_alertsArray=[];_updateAlertsArray(){this._alertsArray=Array.from(this._alerts.values()).sort((e,t)=>t.price-e.price)}_getNewId(){let e=Math.round(Math.random()*1e6).toString(16);for(;this._alerts.has(e);)e=Math.round(Math.random()*1e6).toString(16);return e}}class j extends O{_chart=void 0;_series=void 0;_mouseHandlers;_paneViews=[];_pricePaneViews=[];_lastMouseUpdate=null;_currentCursor=null;_symbolName="";constructor(){super(),this._mouseHandlers=new $}attached({chart:e,series:t,requestUpdate:i}){this._chart=e,this._series=t,this._paneViews=[new S(!1)],this._pricePaneViews=[new S(!0)],this._mouseHandlers.attached(e,t),this._mouseHandlers.mouseMoved().subscribe(r=>{this._lastMouseUpdate=r,i()},this),this._mouseHandlers.clicked().subscribe(r=>{if(r&&this._series){if(this._isHovering(r)){const s=this._series.coordinateToPrice(r.y);s&&(this.addAlert(s),i())}this._hoveringID&&(this.removeAlert(this._hoveringID),i())}},this)}detached(){this._mouseHandlers.mouseMoved().unsubscribeAll(this),this._mouseHandlers.clicked().unsubscribeAll(this),this._mouseHandlers.detached(),this._series=void 0}paneViews(){return this._paneViews}priceAxisPaneViews(){return this._pricePaneViews}updateAllViews(){const e=this.alerts(),t=this._calculateRendererData(e,this._lastMouseUpdate);this._currentCursor=null,(t?.button?.hovering||t?.alerts.some(i=>i.showHover&&i.hoverRemove))&&(this._currentCursor="pointer"),this._paneViews.forEach(i=>i.update(t)),this._pricePaneViews.forEach(i=>i.update(t))}hitTest(){return this._currentCursor?{cursorStyle:this._currentCursor,externalId:"user-alerts-primitive",zOrder:"top"}:null}setSymbolName(e){this._symbolName=e}_isHovering(e){return!!(e&&e.xPositionRelativeToPriceScale>=1&&e.xPositionRelativeToPriceScale<f)}_isHoveringRemoveButton(e,t,i,r){if(!e||!t||Math.abs(e.y-i)>L/2)return!1;const a=P*2+_+r*H,o=(t+a-_)*.5;return Math.abs(e.x-o)<=_/2}_hoveringID="";_calculateRendererData(e,t){if(!this._series)return null;const i=this._series.priceFormatter(),r=t&&!t.overTimeScale,s=r,a=t&&this._series.coordinateToPrice(t.y),o=i.format(a??-100);let h=1/0,l=-1;const c=e.map((d,b)=>{const u=this._series.priceToCoordinate(d.price)??-100;if(t?.y&&u>=0){const m=Math.abs(t.y-u);m<h&&(l=b,h=m)}return{y:u,showHover:!1,price:d.price,id:d.id}});if(this._hoveringID="",l>=0&&h<E){const d=this._chart?.timeScale().width()??0,b=c[l],u=`${this._symbolName} crossing ${this._series.priceFormatter().format(b.price)}`,m=this._isHoveringRemoveButton(t,d,b.y,u.length);c[l]={...c[l],showHover:!0,text:u,hoverRemove:m},m&&(this._hoveringID=b.id)}return{alertIcon:T,alerts:c,button:s?{hovering:this._isHovering(t),hoverColor:"#50535E",crosshairLabelIcon:W}:null,color:"#131722",crosshair:r?{y:t.y,text:o}:null}}}const q=document.querySelector("#chart");if(!q)throw new Error("Chart Container Missing!");const A=p("chart",{autoSize:!0,grid:{vertLines:{visible:!1},horzLines:{visible:!1}},timeScale:{borderVisible:!1},rightPriceScale:{borderVisible:!1},crosshair:{horzLine:{visible:!1,labelVisible:!1},vertLine:{labelVisible:!1,style:V.Solid,width:1}},handleScale:!1,handleScroll:!1}),z=A.addSeries(D,{lineColor:"rgb(4,153,129)",topColor:"rgba(4,153,129, 0.4)",bottomColor:"rgba(4,153,129, 0)",priceLineVisible:!1,lastPriceAnimation:F.Continuous}),G=B();z.setData(G);const w=new j;w.setSymbolName("AAPL");z.attachPrimitive(w);A.timeScale().fitContent();w.alertAdded().subscribe(n=>{console.log(`➕ Alert added @ ${n.price} with the id: ${n.id}`)});w.alertRemoved().subscribe(n=>{console.log(`❌ Alert removed with the id: ${n}`)});
