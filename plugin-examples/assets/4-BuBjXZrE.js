import{q as f,n as w}from"./lightweight-charts.production-Co-rHmTL.js";import{g as I}from"./sample-data-x_8-FZm1.js";import{P as x}from"./plugin-base-8m8IYSME.js";function T(o){return JSON.parse(JSON.stringify(o))}class d{numbers;cache;constructor(e){this.numbers=e,this.cache=new Map}findClosestIndex(e,t){const i=`${e}:${t}`;if(this.cache.has(i))return this.cache.get(i);const s=this._performSearch(e,t);return this.cache.set(i,s),s}_performSearch(e,t){let i=0,s=this.numbers.length-1;if(e<=this.numbers[0].time)return 0;if(e>=this.numbers[s].time)return s;for(;i<=s;){const n=Math.floor((i+s)/2),r=this.numbers[n].time;if(r===e)return n;r>e?s=n-1:i=n+1}return t==="left"?i:s}}class p{_arr;_chunkSize;_cache;constructor(e,t=10){this._arr=e,this._chunkSize=t,this._cache=new Map}getMinMax(e,t){const i=`${e}:${t}`;if(i in this._cache)return this._cache.get(i);const s={lower:1/0,upper:-1/0},n=Math.floor(e/this._chunkSize),r=Math.floor(t/this._chunkSize);for(let c=n;c<=r;c++){const a=c*this._chunkSize,u=Math.min((c+1)*this._chunkSize-1,this._arr.length-1),_=`${a}:${u}`;if(_ in this._cache.keys()){const h=this._cache.get(i);this._check(h,s)}else{const h={lower:1/0,upper:-1/0};for(let l=a;l<=u;l++)this._check(this._arr[l],h);this._cache.set(_,h),this._check(h,s)}}return this._cache.set(i,s),s}_check(e,t){e.lower<t.lower&&(t.lower=e.lower),e.upper>t.upper&&(t.upper=e.upper)}}class g{_viewData;constructor(e){this._viewData=e}draw(){}drawBackground(e){const t=this._viewData.data;e.useBitmapCoordinateSpace(i=>{const s=i.context;s.scale(i.horizontalPixelRatio,i.verticalPixelRatio),s.strokeStyle=this._viewData.options.lineColor,s.lineWidth=this._viewData.options.lineWidth,s.beginPath();const n=new Path2D,r=new Path2D;n.moveTo(t[0].x,t[0].upper),r.moveTo(t[0].x,t[0].upper);for(const a of t)n.lineTo(a.x,a.upper),r.lineTo(a.x,a.upper);const c=t.length-1;n.lineTo(t[c].x,t[c].lower),r.moveTo(t[c].x,t[c].lower);for(let a=t.length-2;a>=0;a--)n.lineTo(t[a].x,t[a].lower),r.lineTo(t[a].x,t[a].lower);n.lineTo(t[0].x,t[0].upper),n.closePath(),s.stroke(r),s.fillStyle=this._viewData.options.fillColor,s.fill(n)})}}class S{_source;_data;constructor(e){this._source=e,this._data={data:[],options:this._source._options}}update(){const e=this._source.series,t=this._source.chart.timeScale();this._data.data=this._source._bandsData.map(i=>({x:t.timeToCoordinate(i.time)??-100,upper:e.priceToCoordinate(i.upper)??-100,lower:e.priceToCoordinate(i.lower)??-100}))}renderer(){return new g(this._data)}}function k(o){if(o.close)return o.close;if(o.value)return o.value}const V={lineColor:"rgb(25, 200, 100)",fillColor:"rgba(25, 200, 100, 0.25)",lineWidth:1};class D extends x{_paneViews;_seriesData=[];_bandsData=[];_options;_timeIndices;_upperLower;constructor(e={}){super(),this._options={...V,...e},this._paneViews=[new S(this)],this._timeIndices=new d([]),this._upperLower=new p([])}updateAllViews(){this._paneViews.forEach(e=>e.update())}paneViews(){return this._paneViews}attached(e){super.attached(e),this.dataUpdated("full")}dataUpdated(e){this._seriesData=T(this.series.data()),this.calculateBands(),e==="full"&&(this._timeIndices=new d(this._seriesData))}_minValue=Number.POSITIVE_INFINITY;_maxValue=Number.NEGATIVE_INFINITY;calculateBands(){const e=new Array(this._seriesData.length);let t=0;this._minValue=Number.POSITIVE_INFINITY,this._maxValue=Number.NEGATIVE_INFINITY,this._seriesData.forEach(i=>{const s=k(i);if(s===void 0)return;const n=s*1.1,r=s*.9;n>this._maxValue&&(this._maxValue=n),r<this._minValue&&(this._minValue=r),e[t]={upper:n,lower:r,time:i.time},t+=1}),e.length=t,this._bandsData=e,this._upperLower=new p(this._bandsData,4)}autoscaleInfo(e,t){const i=this.chart.timeScale(),s=i.coordinateToTime(i.logicalToCoordinate(e)??0)??0,n=i.coordinateToTime(i.logicalToCoordinate(t)??5e9)??5e9,r=this._timeIndices.findClosestIndex(s,"left"),c=this._timeIndices.findClosestIndex(n,"right"),a=this._upperLower.getMinMax(r,c);return{priceRange:{minValue:a.lower,maxValue:a.upper}}}}const b=window.chart=f("chart",{autoSize:!0}),m=b.addSeries(w),C=I();m.setData(C);const N=new D;m.attachPrimitive(N);
