import{C as F}from"./closest-index-Caghc_8Z.js";import{e as S}from"./timestamp-data-Dz1yihFk.js";function g(s){for(const n of s){if(typeof n.close=="number")return"close";if(typeof n.value=="number")return"value"}return null}function q(s,n,u){const h=u.primarySource??g(s);if(!h)throw new Error("Please provide a `primarySource` for the primary data of the correlation indicator.");const p=u.secondarySource??g(n);if(!p)throw new Error("Please provide a `secondarySource` for the secondary data of the correlation indicator.");S(s);const x=new F(S(n)),c=u.length,e=[],o=[];return s.map(i=>{const l={time:i.time},N=i[h];if(N===void 0)return e.push(NaN),o.push(NaN),e.length>c&&(e.shift(),o.shift()),l;const I=x.findClosestIndex(i.time,"left"),w=n[I],v=w?.[p],M=w?.time===i.time;if(v===void 0||!u.allowMismatchedDates&&!M)return e.push(NaN),o.push(NaN),e.length>c&&(e.shift(),o.shift()),l;if(e.push(N),o.push(v),e.length>c&&(e.shift(),o.shift()),e.length<c||e.some(isNaN)||o.some(isNaN))return l;const m=c,d=e.reduce((r,t)=>r+t,0),f=o.reduce((r,t)=>r+t,0),C=e.reduce((r,t,E)=>r+t*o[E],0),V=e.reduce((r,t)=>r+t*t,0),X=o.reduce((r,t)=>r+t*t,0),Y=m*C-d*f,y=Math.sqrt((m*V-d*d)*(m*X-f*f));let a;return y===0?a=0:(a=Y/y,a=Math.max(-1,Math.min(1,a))),{time:i.time,value:a}})}export{q as c};
